<project basedir="." name="Tests" default="run">
	<!-- === property definitions === -->
	<property name="test.dir" value="test" />
	<property name="bin.dir" value="bin" />
	<property name="lib.dir" value="../lib" />
	<property name="interfaces.dir" value="../common/interfaces" />
	<property name="ast.dir" value="../ast" />
	<property name="backend.dir" value="../backend" />
	<property name="controller.dir" value="../controller" />
	<property name="intermediateCodeGenerator.dir" value="../intermediateCodeGenerator" />
	<property name="lexer.dir" value="../lexer" />
	<property name="parser.dir" value="../parser" />
	<property name="semanticAnalyzer.dir" value="../semanticAnalyzer" />
	<property name="symbolTable.dir" value="../symbolTable" />
	<property name="etc.dir" value="../etc" />
	
	<!-- === class path === -->
	<path id="classpath-test">
		<pathelement location="${interfaces.dir}/${bin.dir}" />
		<pathelement location="${ast.dir}/${bin.dir}" />
		<pathelement location="${backend.dir}/${bin.dir}" />
		<pathelement location="${controller.dir}/${bin.dir}" />
		<pathelement location="${intermediateCodeGenerator.dir}/${bin.dir}" />
		<pathelement location="${lexer.dir}/${bin.dir}" />
		<pathelement location="${parser.dir}/${bin.dir}" />
		<pathelement location="${semanticAnalyzer.dir}/${bin.dir}" />
		<pathelement location="${symbolTable.dir}/${bin.dir}" />
		<pathelement location="${bin.dir}" />
		<pathelement location="${lib.dir}/hamcrest-core-1.3.jar" />
		<pathelement location="${lib.dir}/junit-4.11.jar" />
		<pathelement location="${lib.dir}/privilegedaccessor-1.2.1.jar" />
		<pathelement location="${etc.dir}" />
		<pathelement location="${lib.dir}/log4j-1.2.17.jar" />
	</path>
	
	<!-- === clean === -->
	<target name="clean" description="clean compiled classes from ${bin.dir}">
		<delete dir="${bin.dir}" />
	</target>
	
	<!-- === dependencies === -->
	<target name="dependencies" description="compile the dependencies">
		<ant antfile="build.xml" dir="${interfaces.dir}" target="build" inheritall="false" />
		<ant antfile="build.xml" dir="${ast.dir}" target="build" inheritall="false" />
		<ant antfile="build.xml" dir="${backend.dir}" target="build" inheritall="false" />
		<ant antfile="build.xml" dir="${controller.dir}" target="build" inheritall="false" />
		<ant antfile="build.xml" dir="${intermediateCodeGenerator.dir}" target="build" inheritall="false" />
		<ant antfile="build.xml" dir="${lexer.dir}" target="build" inheritall="false" />
		<ant antfile="build.xml" dir="${parser.dir}" target="build" inheritall="false" />
		<ant antfile="build.xml" dir="${semanticAnalyzer.dir}" target="build" inheritall="false" />
		<ant antfile="build.xml" dir="${symbolTable.dir}" target="build" inheritall="false" />
	</target>
	
	<!-- === compile JUnit test classes === -->
	<target name="build-test" depends="dependencies" description="compile the JUnit test classes">
		<mkdir dir="${bin.dir}" />
		<javac srcdir="${test.dir}" destdir="${bin.dir}" classpathref="classpath-test" includeantruntime="false"/>
	</target>
	
	<!-- === run JUnit test classes === -->
		<target name="run-test" depends="build-test" description="run the JUnit test classes">
			<junit errorProperty="test.failed" failureProperty="test.failed">
				<classpath>
					<path refid="classpath-test" />
				</classpath>
				<formatter type="plain" usefile="no" />
				<batchtest>
					<fileset dir="${test.dir}">
						<include name="**/*Test.java" />
					</fileset>
				</batchtest>
			</junit>
			<fail if="test.failed" message="one or more unit tests failed"/>
		</target>
	
	<!-- === run === -->
	<target name="run" depends="run-test" description="run all tests">
	</target>
</project>